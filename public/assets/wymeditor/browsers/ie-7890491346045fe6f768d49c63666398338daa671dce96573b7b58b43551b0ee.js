/*
 * WYMeditor : what you see is What You Mean web-based editor
 * Copyright (c) 2005 - 2009 Jean-Francois Hovinne, http://www.wymeditor.org/
 * Dual licensed under the MIT (MIT-license.txt)
 * and GPL (GPL-license.txt) licenses.
 *
 * For further information visit:
 *        http://www.wymeditor.org/
 *
 * File Name:
 *        jquery.wymeditor.explorer.js
 *        MSIE specific class and functions.
 *        See the documentation for more info.
 *
 * File Authors:
 *        Jean-Francois Hovinne (jf.hovinne a-t wymeditor dotorg)
 *        Bermi Ferrer (wymeditor a-t bermi dotorg)
 *        FrÃ©dÃ©ric Palluel-Lafleur (fpalluel a-t gmail dotcom)
 *        Jonatan Lundin (jonatan.lundin a-t gmail dotcom)
 */
WYMeditor.WymClassExplorer=function(e){this._wym=e,this._class="className",this._newLine="\r\n"},WYMeditor.WymClassExplorer.prototype.format_block=function(e){var t=this,o=e||t.selected()||$(t._iframe).contents().find("body").get(0),i=o.tagName.toLowerCase();$.inArray(i,["strong","b","em","i","sub","sup","a"])>-1&&(i=o.parentNode.tagName.toLowerCase()),i==WYMeditor.BODY&&(t._selected_image=null,$(t._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),t._exec(WYMeditor.FORMAT_BLOCK,"<"+WYMeditor.P+">"))},WYMeditor.WymClassExplorer.prototype.initIframe=function(iframe){this._iframe=iframe,this._doc=iframe.contentWindow.document;var styles=this._doc.styleSheets[0],aCss=eval(this._options.editorStyles);this.addCssRules(this._doc,aCss),this._doc.title=this._wym._index,$("html",this._doc).attr("dir",this._options.direction),$("html",this._doc).addClass("ie"),$(this._doc.body).html(this._wym._html);var wym=this;this._doc.body.onfocus=function(){wym._doc.designMode="on",wym._doc=iframe.contentWindow.document},this._doc.onbeforedeactivate=function(){wym.saveCaret()},this._doc.onkeyup=function(){wym.saveCaret(),wym.keyup()},this._doc.onclick=function(){wym.saveCaret()},this._doc.body.onbeforepaste=function(){wym._iframe.contentWindow.event.returnValue=!1},this._doc.body.onpaste=function(){wym._iframe.contentWindow.event.returnValue=!1,wym.paste(window.clipboardData.getData("Text"))},this._initialized&&($.isFunction(this._options.preBind)&&this._options.preBind(this),this._wym.bindEvents(),$.isFunction(this._options.postInit)&&this._options.postInit(this),this.listen()),this._initialized=!0,this._doc.designMode="on";try{this._doc=iframe.contentWindow.document}catch(e){}},WYMeditor.WymClassExplorer.prototype._exec=function(e,t){var o=this;switch(e){case WYMeditor.INDENT:case WYMeditor.OUTDENT:var i=o.findUp(o.container(),WYMeditor.LI);if(i){var s=i.parentNode.parentNode;(i.parentNode.childNodes.length>1||$.inArray(s.tagName.toLowerCase(),[WYMeditor.OL,WYMeditor.UL])>-1)&&o._doc.execCommand(e)}break;default:t?o._doc.execCommand(e,!1,t):o._doc.execCommand(e)}},WYMeditor.WymClassExplorer.prototype.selected=function(){var e=this._iframe.contentWindow.document.caretPos;return null!=e&&void 0!=e.parentElement?e.parentElement():void 0},WYMeditor.WymClassExplorer.prototype.saveCaret=function(){this._doc.caretPos=this._doc.selection.createRange()},WYMeditor.WymClassExplorer.prototype.addCssRule=function(e,t){e.addRule(t.name,t.css)},WYMeditor.WymClassExplorer.prototype.insert=function(e){var t=this._doc.selection.createRange();if($(t.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{t.pasteHTML(e)}catch(o){}else this.paste(e)},WYMeditor.WymClassExplorer.prototype.wrap=function(e,t){var o=this._doc.selection.createRange();if($(o.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{o.pasteHTML(e+o.text+t)}catch(i){}},WYMeditor.WymClassExplorer.prototype.unwrap=function(){var e=this._doc.selection.createRange();if($(e.parentElement()).parents(this._options.iframeBodySelector).is("*"))try{var t=e.text;this._exec("Cut"),e.pasteHTML(t)}catch(o){}},WYMeditor.WymClassExplorer.prototype.keyup=function(e){(wym=this)._selected_image=null,$(wym._iframe).contents().find(".selected_by_wym").removeClass("selected_by_wym"),wym.format_block()},WYMeditor.WymClassExplorer.prototype.setFocusToNode=function(e,t){(wym=this)._iframe.contentWindow.focus();var o=wym._doc.selection.createRange();t=t?!0:!1,o.moveToElementText(e),o.collapse(t),o.select(),e.focus()};